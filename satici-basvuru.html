<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SatÄ±cÄ± Ol | Siftah</title>
    <link rel="icon" href="/images/navbar/logo.png" type="image/png" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="seller-register.css" />

  </head>
  <body>
    <div id="successModal" class="modal-overlay">
      <div class="modal-card">
        <div class="modal-icon">
          <i class="fa-solid fa-check"></i>
        </div>
        <h2>BaÅŸvurunuz AlÄ±ndÄ±! ðŸŽ‰</h2>
        <p>
          Profiliniz hÄ±zla incelenecek ve onaylandÄ±ÄŸÄ±nda sizi bilgilendireceÄŸiz.
          Siftah ailesine hoÅŸ geldiniz!
        </p>
        <button
          class="btn-modal"
          onclick="window.location.href='satici-girisi.html'"
        >
          GiriÅŸ Yap
        </button>
      </div>
    </div>

    <div id="toast-container"></div>

    <div class="register-wrapper">
      
      <div class="register-visual">
        <div class="visual-content">
          <a href="/" class="logo-link">
            <span class="logo-text">siftah</span>
          </a>
          <h2>Vitrinini AÃ§,<br />Hikayeni PaylaÅŸ.</h2>
          <p>Binlerce alÄ±cÄ±ya komisyonsuz ulaÅŸmanÄ±n en ÅŸÄ±k yolu.</p>
          <div class="visual-footer">
            <span>Â© 2025 Siftah Inc.</span>
          </div>
        </div>
        <img
          src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2070&auto=format&fit=crop"
          alt="MaÄŸaza"
          class="bg-image"
        />
        <div class="overlay"></div>
      </div>

      <div class="register-form-container">
        <div class="mobile-header">
          <a href="/" class="back-btn"><i class="fa-solid fa-chevron-left"></i> Anasayfa</a>
          <span class="mobile-logo">siftah</span>
          <div class="spacer" style="width: 80px;"></div> 
        </div>
        
        <div class="form-header">
          <h1>SatÄ±cÄ± BaÅŸvurusu</h1>
          <p>HesabÄ±nÄ±zÄ± oluÅŸturun ve vitrinizi hazÄ±rlamaya baÅŸlayÄ±n.</p>
        </div>

        <div class="steps-indicator">
          <div class="step active" id="step1-indicator">
            <div class="circle">1</div>
            <span>Ãœyelik</span>
          </div>
          <div class="line"></div>
          <div class="step" id="step2-indicator">
            <div class="circle">2</div>
            <span>Marka</span>
          </div>
        </div>

        <form id="sellerForm">
          <div class="form-step active" id="step1">
            <div class="input-row">
              <div class="input-group">
                <label>AdÄ±nÄ±z</label>
                <input
                  type="text"
                  name="name"
                  placeholder="Ã–rn: Ahmet"
                  required
                />
              </div>
              <div class="input-group">
                <label>SoyadÄ±nÄ±z</label>
                <input
                  type="text"
                  name="surname"
                  placeholder="Ã–rn: YÄ±lmaz"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <label>E-posta Adresi</label>
              <input
                type="email"
                name="email"
                placeholder="ornek@sirket.com"
                required
              />
            </div>

            <div class="input-row">
              <div class="input-group">
                <label>Åžifre</label>
                <input
                  type="password"
                  name="password"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  required
                />
              </div>
              <div class="input-group">
                <label>Åžifre (Tekrar)</label>
                <input
                  type="password"
                  name="confirmPassword"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  required
                />
              </div>
            </div>

            <div class="input-group">
              <label>Cep Telefonu</label>
              <input
                type="tel"
                name="phone"
                placeholder="05XX XXX XX XX"
                maxlength="11"
                required
              />
            </div>

            <div class="input-group">
              <label>T.C. Kimlik No</label>
              <input
                type="text"
                name="tc_no"
                placeholder="11 haneli T.C. Kimlik No"
                maxlength="11"
                required
              />
            </div>

            <div class="form-actions">
              <button
                type="button"
                class="btn btn-primary w-100"
                onclick="nextStep()"
              >
                Devam Et
              </button>
            </div>
            <p class="login-redirect">
              Zaten hesabÄ±n var mÄ±? <a href="satici-girisi.html">GiriÅŸ Yap</a>
            </p>
          </div>

          <div class="form-step" id="step2">
            <div class="input-group">
              <label>Marka / MaÄŸaza AdÄ±</label>
              <input
                type="text"
                name="brandName"
                placeholder="Ã–rn: Mina's Touch"
                required
              />
            </div>

            <div class="input-row">
              <div class="input-group">
                <label>Kategori</label>
                <select name="category" required>
                  <option value="" disabled selected>
                    MarkanÄ±zÄ±n ana kategorisini seÃ§in
                  </option>
                  <optgroup label="Moda & Giyim">
                    <option value="giyim_kadin">KadÄ±n Giyim</option>
                    <option value="giyim_erkek">Erkek Giyim</option>
                    <option value="giyim_cocuk">Ã‡ocuk & Bebek Giyim</option>
                    <option value="ayakkabi">AyakkabÄ± & Ã‡anta</option>
                    <option value="aksesuar">Aksesuar & TakÄ±</option>
                    <option value="ic_giyim">Ä°Ã§ Giyim & Pijama</option>
                  </optgroup>
                  <optgroup label="GÃ¼zellik & BakÄ±m">
                    <option value="kozmetik">Kozmetik & Makyaj</option>
                    <option value="parfum">ParfÃ¼m & Deodorant</option>
                    <option value="cilt_bakim">Cilt & VÃ¼cut BakÄ±mÄ±</option>
                    <option value="sac_bakim">SaÃ§ BakÄ±mÄ±</option>
                  </optgroup>
                  <optgroup label="Ev & YaÅŸam">
                    <option value="ev_tekstili">Ev Tekstili</option>
                    <option value="mobilya">Mobilya & Dekorasyon</option>
                    <option value="mutfak">Mutfak GereÃ§leri</option>
                    <option value="aydinlatma">AydÄ±nlatma</option>
                    <option value="yapi_market">YapÄ± Market & BahÃ§e</option>
                  </optgroup>
                  <optgroup label="Elektronik">
                    <option value="telefon">Telefon & AksesuarlarÄ±</option>
                    <option value="bilgisayar">Bilgisayar & Tablet</option>
                    <option value="ev_elektronigi">Ev ElektroniÄŸi</option>
                    <option value="kisisel_bakim_elektronigi">
                      KiÅŸisel BakÄ±m Aletleri
                    </option>
                  </optgroup>
                  <optgroup label="Hobi & EÄŸlence">
                    <option value="spor">Spor & Outdoor</option>
                    <option value="kitap">Kitap & KÄ±rtasiye</option>
                    <option value="oyuncak">Oyuncak & Hobi</option>
                    <option value="petshop">Pet Shop</option>
                    <option value="sanat">Sanat & Koleksiyon</option>
                  </optgroup>
                  <optgroup label="DiÄŸer">
                    <option value="market">SÃ¼permarket & GÄ±da</option>
                    <option value="otomotiv">Otomotiv & Aksesuar</option>
                    <option value="diger">DiÄŸer</option>
                  </optgroup>
                </select>
              </div>
              <div class="input-group">
                <label>TecrÃ¼be</label>
                <select name="experience" required>
                  <option value="" disabled selected>SeÃ§iniz</option>
                  <option value="yeni">Yeni BaÅŸlÄ±yorum</option>
                  <option value="orta">1-3 YÄ±l</option>
                  <option value="uzman">3+ YÄ±l (Profesyonel)</option>
                </select>
              </div>
            </div>

            <div class="input-group">
              <label>IBAN NumarasÄ±</label>
              <div class="iban-wrapper">
                <span class="prefix">TR</span>
                <input
                  type="text"
                  name="iban"
                  placeholder="XX 0000 0000 0000 0000 0000 00"
                  maxlength="24"
                  required
                />
              </div>
            </div>

            <div class="input-row">
              <div class="input-group">
                <label>MaÄŸaza Logosu</label>
                <div class="file-upload-box">
                  <input
                    type="file"
                    id="logoUpload"
                    name="logo"
                    accept="image/*"
                    hidden
                    onchange="previewImage(event, 'logoPreview', 'logoLabel')"
                  />
                  <label for="logoUpload" class="upload-label" id="logoLabel">
                    <div class="icon">
                      <i class="fa-solid fa-cloud-arrow-up"></i>
                    </div>
                    <span id="uploadText">Logo SeÃ§in</span>
                  </label>
                  <img
                    id="logoPreview"
                    class="preview-img hidden"
                    style="width: 100%; height: 100px; object-fit: contain"
                  />
                </div>
              </div>

              <div class="input-group">
                <label>SatÄ±cÄ± Profil Resmi</label>
                <div class="file-upload-box">
                  <input
                    type="file"
                    id="profileUpload"
                    name="profileImage"
                    accept="image/*"
                    hidden
                    onchange="previewImage(event, 'profilePreview', 'profileLabel')"
                  />
                  <label
                    for="profileUpload"
                    class="upload-label"
                    id="profileLabel"
                  >
                    <div class="icon">
                      <i class="fa-solid fa-user-circle"></i>
                    </div>
                    <span id="uploadText">Profil SeÃ§in</span>
                  </label>
                  <img
                    id="profilePreview"
                    class="preview-img hidden"
                    style="
                      width: 100%;
                      height: 100px;
                      object-fit: cover;
                      border-radius: 10px;
                    "
                  />
                </div>
              </div>
            </div>

            <div class="form-actions dual-btn">
              <button
                type="button"
                class="btn btn-outline"
                onclick="prevStep()"
              >
                Geri DÃ¶n
              </button>
              <button type="submit" class="btn btn-primary">
                KaydÄ± Tamamla
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script>
      // --- 1. GLOBAL UI (TOAST) ---
      function showToast(type, title, message) {
        const container = document.getElementById("toast-container");
        if (!container) return;
        let icon = "fa-circle-check";
        if (type === "error") icon = "fa-circle-exclamation";
        const toast = document.createElement("div");
        toast.className = `siftah-toast ${type}`;
        toast.innerHTML = `<i class="fa-solid ${icon}"></i><div class="toast-content"><span class="toast-title">${title}</span><span class="toast-msg">${message}</span></div>`;
        container.appendChild(toast);
        setTimeout(() => {
          toast.style.animation = "fadeOut 0.5s ease forwards";
          setTimeout(() => toast.remove(), 500);
        }, 3000);
      }

      // --- 2. YARDIMCI FONKSÄ°YONLAR ---
      function enforceNumericInput(event) {
        this.value = this.value.replace(/\D/g, "");
      }
      const phoneInput = document.querySelector('input[name="phone"]');
      const tcInput = document.querySelector('input[name="tc_no"]');
      const ibanInput = document.querySelector('input[name="iban"]');
      if (phoneInput) phoneInput.addEventListener("input", enforceNumericInput);
      if (tcInput) tcInput.addEventListener("input", enforceNumericInput);
      if (ibanInput)
        ibanInput.addEventListener("input", function () {
          this.value = this.value.replace(/[^0-9]/g, "");
        });

      // Ortak Resim Ã–nizleme
      function previewImage(event, imgId, labelId) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = document.getElementById(imgId);
            img.src = e.target.result;
            img.classList.remove("hidden");
            document.getElementById(labelId).style.display = "none";
          };
          reader.readAsDataURL(file);
        }
      }

      // --- 3. ADIM GEÃ‡Ä°ÅžLERÄ° ---
      function nextStep() {
        const step1Div = document.getElementById("step1");
        const inputs = step1Div.querySelectorAll("input");
        const pass1 = step1Div.querySelector('input[name="password"]');
        const pass2 = step1Div.querySelector('input[name="confirmPassword"]');
        let isValid = true;
        inputs.forEach((input) => {
          if (!input.checkValidity()) {
            input.reportValidity();
            isValid = false;
          }
        });

        if (isValid) {
          const strongRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
          if (!strongRegex.test(pass1.value)) {
            showToast(
              "error",
              "ZayÄ±f Åžifre",
              "Åžifre en az 8 karakter, bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf ve rakam iÃ§ermeli."
            );
            isValid = false;
          } else if (pass1.value !== pass2.value) {
            showToast("error", "Hata", "Åžifreler uyuÅŸmuyor!");
            isValid = false;
          }
        }

        if (isValid) {
          document.getElementById("step1").classList.remove("active");
          document.getElementById("step2").classList.add("active");
          document.getElementById("step1-indicator").classList.add("completed");
          document.getElementById("step1-indicator").classList.remove("active");
          document.getElementById("step2-indicator").classList.add("active");
        }
      }

      function prevStep() {
        document.getElementById("step2").classList.remove("active");
        document.getElementById("step1").classList.add("active");
        document.getElementById("step2-indicator").classList.remove("active");
        document
          .getElementById("step1-indicator")
          .classList.remove("completed");
        document.getElementById("step1-indicator").classList.add("active");
      }

      // --- 4. BACKEND'E GÃ–NDERME (FORMDATA + MODAL) ---
      const form = document.getElementById("sellerForm");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = "Ä°ÅŸleniyor...";

        // !!! KRÄ°TÄ°K NOKTA: JSON deÄŸil FormData kullanÄ±yoruz !!!
        const formData = new FormData();

        // Metin Verilerini Ekle
        formData.append("name", form.name.value);
        formData.append("surname", form.surname.value);
        formData.append("email", form.email.value);
        formData.append("password", form.password.value);
        formData.append("phone", form.phone.value);
        formData.append("tc_no", form.tc_no.value);
        formData.append("brandName", form.brandName.value);
        formData.append("category", form.category.value);
        formData.append("experience", form.experience.value);
        formData.append("iban", form.iban.value);
        formData.append("role", "seller");

        // DosyalarÄ± Ekle (Varsa)
        const logoInput = document.getElementById("logoUpload");
        if (logoInput.files[0]) formData.append("logo", logoInput.files[0]);

        const profileInput = document.getElementById("profileUpload");
        if (profileInput.files[0])
          formData.append("profileImage", profileInput.files[0]);

        try {
          // !!! DÄ°KKAT: headers KISMINI SÄ°LDÄ°K !!!
          // Browser otomatik olarak multipart/form-data sÄ±nÄ±rlarÄ±nÄ± ayarlar.
          const response = await fetch(
            "http://localhost:5000/api/auth/register",
            {
              method: "POST",
              body: formData,
            }
          );

          const data = await response.json();

          if (response.ok) {
            const modal = document.getElementById("successModal");
            modal.classList.add("active");
          } else {
            showToast(
              "error",
              "KayÄ±t BaÅŸarÄ±sÄ±z",
              data.message || "Bir sorun oluÅŸtu."
            );
            submitBtn.disabled = false;
            submitBtn.textContent = "KaydÄ± Tamamla";
          }
        } catch (error) {
          console.error("Sunucu HatasÄ±:", error);
          showToast("error", "Sunucu HatasÄ±", "BaÄŸlantÄ± kurulamadÄ±.");
          submitBtn.disabled = false;
          submitBtn.textContent = "KaydÄ± Tamamla";
        }
      });
    </script>
  </body>
</html>
